# TODO

> ☑☐☒❗

- stats, 
    - new apex chart, 
        - ☑ lines
            - ☑ suivi des montants sur chaque compte
            - ☒ regroupement et cumul global de l'ensemble des comptes
        - stacked bars
            - ☑ fix categories, Voyage manquant + possibles catégo manquantes dans l'initialisation
            - ☑ fix changement d'année
            - ☑ fix dernière stack bar 2024 mal groupée, quelques catégories se superposent
            - ☑ ajouter 1 bouton pour suppr toutes les catégories + 1 autre pour toutes les remettre
            - ☑ ajouter 1 liste de catégo par défaut à l'ouverture de la page
            - ☑ ajouter un switch mois/année
            - ☑ ajouter un switch gains/dépense
            - ☐ afficher les noms des catégories lors du clic/survol d'une catégo dans le graph
            - ☑ retirer la fonctionnalité de grouper les catégories, inutile
- ☐ faire des tests automatisés pour la partie front
- ☐ ajout système de données récurrentes:
    - ☐ améliorer l'UI en bloquant l'espace via `visibility: hidden`, permettra de ne plus faire de trou dans la page au changement
        - vérif si bien impossible de cliquer sur l'elem invisible, sinon ajouter un `disable`
- ☐❗❗ ajout système de budget:
    - ☑ ajout des champs et possibilité de modification des infos de budget
    - ☐ budget de dépense par catégorie
    - ☐ stats sur les budgets activés
    - ☐ info sur le budget en cours à la saisie ?
- ☐ simplifier les catégories:
    - ☐ ajouter 2 niveaux de catégories, avec en mode simple 1 seul niveau obligatoire
- ☐ ajout préférences utilisateur:
    - ☐ gestion des préférences de format de date EN + FR avec / ou -
    - ☐ gestion des préférences de format csv séparateur colonne + separateur décimal
    - ☐ laisser l'overide possible dans les parties import/export csv, mais préselectionner la préférence
- ☐ partie import export CSV: 
    - ☐❗❗ ajouter un champ `-` à la fin du csv pour permettre l'édition dans Excel + sauvegarde et réimporter directement
    - ☐ mettre un champ `lastCSVexport` de type date par user à ramener dans le menu (ok si - d'1 mois, ko sinon)
        - ☐ compter le nombre de lignes à exporter et afficher/bloquer un import si différent de 0 ?
- ☐ ajout validation des dépenses: POST ValidateRows
    - ☑ système qui ramène l'ensemble des lignes encore non validées
    - ☑ voir pour permettre de la validation de groupe en saisissant une date unique et en sélectionnant X lignes
    - ☐❗ à chaque validation, voir pour garder les paramètres spé si utilisés
    - ☐❗❗ refonte des 2 méthodes POST pour les séparer
        la recherche de données est à séparer des validations/annulation pour ne pas recharger les données de base à chaque POST
    - ☐ permettre l'édition d'une ligne, page dédiée, ou mettre 3 radio: validation/édition/annulation ?
- ☐ ajout multi utilisateur sur un compte
    - ☐ un utilisateur admin du compte qui peut en ajouter d'autres (max 5)
    - ☐ les autres utilisateurs peuvent se connecter en simultané sur le compte sans possibilité d'ajout d'autres nouveaux
    - ☐ 1 ligne de login active par utilisateur, permettra du multi utilisateur / multi login sur différentes plateformes
- ☐ Ajout de statistiques 
    - ☐ sur le nombre de requêtes des utilisateurs pour voir les actifs ? (tableau admin?)
    - ☐ ajouter un graph des dépenses mois par mois (des 6/12 derniers mois ?)


## Done
- ☑ sur toutes les tables, mettre la désignation à la fin pour gagner de la visibilité sur smartphone (voir partie validation qui est ok)
- ☑ dates via svg = 22 jan, fev, mar, avr, mai, juin, juil, aou ...
- ☑ dès que toutes les fonctionnalités essentielles sont en place, démarrer des tests fonctionnels

- ☑ ajout système de données récurrentes:
    - ☑ factures + revenus mensuelles
    - ☑ création, édition, suppression
    - ☑ enregistrement avec ajout de jour/mois/année auto à chaque enregistrement
    - ☑ fix remettre le submit en mode création après avoir utilisé le mode édition/suppression
- ☑ simplifier les catégories:
    - ☑ ajouter des logos + couleurs par catégorie
    - ☑ nouvelle page de modif des catégories à faire, améliorer l'UI actuelle
    - ☑ rajouter des catégories:
        - ☑ "Autre" par défaut, avec ... en icone et couleur grise ? (more_horiz e5d3 = ...)
        - ☑ "-" avec corbeille en icone = delete e872 couleur rouge
    - ☑ renommer Véhicule qui semble faire planter les correspondances à cause de l'accent (ne faisait pas planter mais é retiré pour ne plus avoir le doute)
    - ☑ renommer Investissement + Restaurant trop long sur smartphone (max 8 car)
    - ☑ voir si possible d'ajouter le logo dans les listes déroulantes de sélection de catégorie
    - ☑ voir si possible d'ajouter les icones et couleurs dans les listes d'articles, à la place d'écrire les noms des catégories (gain de place dans les tables)
        - ☑ mettre cette fonctionnalité en paramètre, pour pouvoir garder les noms de catégories si souhaité (accessibilité)
    - nouvelles tables 
        - ☑ catégorie dédiée: id, nom, couleur, icone
        - ☑ join: user ID associé à category ID
- ☑ Ajout sauvegarde DB SQLite sur Drive
    - ☑ avec table SQLite qui garde les ID + nom + date de fichiers sauvegardés + le statut de l'upload (pas besoin l'API Google redonne toutes les infos)
    - ☑ voir pour fermer le server et faire la sauvegarde au restart après quelques commandes de nettoyage de DB (semble ok)
    - ☑ voir si la gestion d'une seule ouverture/fermeture DB ferait fonctionner le PRAGMA wal_checkpoint(TRUNCATE) sans retourner BUSY
        - ☑ obj nettoyer les fichiers wal + shm avant sauvegarde
    - ☑ cron based backup : 
        - ☑ made with a go scheduler
        - ☒ https://litestream.io/alternatives/cron/ + monitoring : https://deadmanssnitch.com/account/sign_up?plan=the_lone_snitch
- ☑ partie import export CSV: 
    - ☑ MAJ le champ `exported` lors des exports et modifications de données
    - ☑ ajouter un template de fichier csv (dispo partie import dans les explications)
    - ☑ objectif: chaque export génère un fichier avec l'ensemble des dernières modifs
        - ☑ en jouant toutes les sauvegardes historisées dans l'ordre chronologique, on retrouve l'état des données souhaité
        - ☑ ajout d'une option de RAZ de la colonne `exported`
- ☑ Ajout de statistiques 
    - ☑ pouvoir différencier les montants déjà validés vs non validés
    - ☑ visualisation des données avec filtre et tri via table simple
        - ☒ voir pour mettre un tableur ? + rendre editable ou suppr de ligne
            - https://github.com/wenzhixin/bootstrap-table
            - https://github.com/jspreadsheet/ce
                - https://bossanova.uk/jspreadsheet/v4/docs/quick-reference
    - ☑ ajouter le montant total en cours de validation/annulation lors de la sélection des lignes

## Infos
- PWA
    - Ajout SQLite en WebAssembly ?
- voir pour réduire le nombre d'ouverture/fermeture de DB
    - en go, open démarre un pool de connexion, mettre en place une route DB.Stats pour avoir des infos en temps réel
    - https://go.dev/doc/database/open-handle
    - https://go.dev/doc/database/manage-connections
    - tuto DB in Go : https://dev.to/techschoolguru/how-to-handle-db-errors-in-golang-correctly-11ek
    - DB test case : https://stackoverflow.com/questions/48196746/using-ping-to-find-out-if-db-connection-is-alive-in-golang
- autres améliorations non prioritaires
    - voir pour split le SQL dans des fichiers .sql (exemple: https://github.com/qustavo/dotsql)
    - voir pour split le HTML dans des fichiers séparés (via templating par block?) OU mieux gérer le HTML directement dans go: https://github.com/a-h/templ
    - voir pour créer des packages mieux définis et pouvoir les sortir complètement de cet app (exemple partie auth/session)
    - Tester HTMX sur différents type de réponse : 200, 400, 500 ... : https://htmx.org/extensions/response-targets/ 
    - Amélioration download fichier csv : voir si possible de faire mieux directement via le serveur à la place du js
    - auth
        - check des changements d'IP / user agent pour forcer un relogin
    - other .js chart library: [Chart.js](https://www.chartjs.org/docs/latest/)
